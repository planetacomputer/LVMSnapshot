## LVM. CREACIÓ I MERGE D'UN SNAPSHOT
![Procés de creació  i merge d'un snapshot LVM](data:image/png;base64,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)

 1. Declarar sdb com a PV
 >     pvcreate /dev/sdb

 3. Crear un VG
>     vgcreate vg1 /dev/sdb

 3. Crear un LV, el formatejaré i l'ompliré de dades. L'objectiu és demostrar que puc retornar a aquest LV original
 
>     lvcreate vg1 -L 0.6G -n lv1
> 
(amb lvscan obtinc ruta lvm- si intento montar sense formatejar em dona error)
>     mkfs.ext4 /dev/vg1/lv1
>     mount /dev/vg1/lv1 /mnt/original

4. Crearé un snapshot d'aquest LV original

>     lvcreate -L 100M -n lv1_snap -s /dev/vg1/lv1
>     lvdisplay /dev/vg1/lv1_snap
>     lvdisplay /dev/vg1/lv1  (---source of lv1_snap)

5. Munto lv1_snap per observar què hi ha...
>     mkdir /mnt/snap

6. Modificaré els fitxers del LV original (afegint fitxers, esborrant-ne,...)
#script.sh
>#!/bin/bash
for i in `seq -w 1 100`
do
  touch `date +%Y%m%d`-$i.txt
done
wget http://ipv4.download.thinkbroadband.com/50MB.zip

Observo els canvis:

>     lvdisplay /dev/vg1/lv1_snap
>     lvs vg1

7. Reestablirem el LV original a partir de l'snapshot (que automàticament desapareix)
#Desmuntem els dos volums

>     umount /mnt/{original,snap}
>     lsof | grep /mnt/original  <-- si busy target

#Reestablirem el lv original a partir de l'snap

>     lvconvert --merge /dev/vg1/lv1_snap

#Comprovem que el lv_snap ha desaparegut

>     lvs vg1

#Tornem a muntar el lv per comprovar que hi ha els nostres fitxers del començament

>     mount /dev/vg1/lv1 /mnt/original
>     ls /mnt/original
